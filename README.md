# HorizonFS

HorizonFS æ˜¯ä¸€ä¸ªåŸºäº Go è¯­è¨€æ„å»ºçš„åˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨ç³»ç»ŸåŸå‹ï¼Œé‡‡ç”¨ Raft å…±è¯†åè®®å’Œ gRPC å®ç°é«˜å¯ç”¨æ¶æ„ã€‚é¡¹ç›®èšç„¦å…ƒæ•°æ®æ°´å¹³æ‰©å±•ä¸é«˜æ•ˆæ•°æ®æµå¤„ç†ï¼Œä¸ºæ„å»ºå¤§è§„æ¨¡åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿæä¾›åŸºç¡€æ¡†æ¶ã€‚

---

## æ ¸å¿ƒç‰¹æ€§ âœ¨

### ğŸš€ å…ƒæ•°æ®æ¶æ„

#### ä¸ºæ‰©å±•è®¾è®¡
- åŸºäºé”®å€¼å“ˆå¸Œçš„å…ƒæ•°æ®åˆ†ç‰‡æœºåˆ¶ï¼Œæ”¯æŒå°†å…ƒæ•°æ®åˆ†å¸ƒåˆ°å¤šä¸ª Raft Group
- å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡å“ˆå¸Œè®¡ç®—ç›´æ¥å®šä½ç›®æ ‡ Raft Groupï¼Œæ”¯æŒå‘ä»»æ„èŠ‚ç‚¹ï¼ˆLeader/Followerï¼‰å‘èµ·æŸ¥è¯¢ï¼Œå®ç°å»ä¸­å¿ƒåŒ–æŸ¥è¯¢ï¼Œé˜²æ­¢å•ç‚¹æ•…éšœï¼Œæä¾›äº†é«˜å¯ç”¨æ€§

#### åŸºç¡€å®ç°
- æä¾›å®Œæ•´çš„å• Raft Group å®ç° (cmd/node)ï¼ŒåŒ…å«å…ƒæ•°æ®ä¸€è‡´æ€§ä¿è¯ã€åˆ†å¸ƒå¼å­˜å‚¨é€»è¾‘å’Œé€šä¿¡åè®®æ ˆ

### ğŸ”’ å¼ºä¸€è‡´æ€§ä¿éšœ
- åŸºäº etcd/raft å®ç° Raft å…±è¯†åè®®
- å†…å­˜çŠ¶æ€æœº (Metastore) å®æ—¶åº”ç”¨å·²æäº¤æ—¥å¿—ï¼Œæä¾›å¿«é€Ÿå…ƒæ•°æ®æŸ¥è¯¢å“åº”

### âš¡ é«˜æ€§èƒ½æ•°æ®ç®¡é“

#### æ™ºèƒ½æµå¼ä¼ è¾“
- åŸºäº gRPC åŒå‘æµå®ç°åˆ†å—ä¼ è¾“åè®®ï¼ˆé»˜è®¤ 64KBï¼‰ï¼Œæ”¯æŒå¤§æ–‡ä»¶çš„é«˜æ•ˆä¼ è¾“
- åŠ¨æ€å†…å­˜ç®¡ç†ï¼šåˆ†å—å¤„ç†æœºåˆ¶é™ä½äº†å†…å­˜å³°å€¼æ¶ˆè€—

#### æŒä¹…åŒ–å¼•æ“
- é‡‡ç”¨ BadgerDB åµŒå…¥å¼å­˜å‚¨å¼•æ“ï¼Œè¯»å†™æ€§èƒ½é«˜

### ğŸ§© æ¨¡å—åŒ–æ¶æ„

| æ¨¡å—            | åŠŸèƒ½æè¿°               |
|-----------------|------------------------|
| internal/client | æ™ºèƒ½å®¢æˆ·ç«¯ SDK         |
| internal/node   | åˆ†å¸ƒå¼èŠ‚ç‚¹æ ¸å¿ƒé€»è¾‘     |
| pkg/proto       | gRPC æœåŠ¡æ¥å£å®šä¹‰       |
| cmd/*           | å‘½ä»¤è¡Œå·¥å…·é›†           |

---

## å¿«é€Ÿéƒ¨ç½² ğŸš€

### ç¯å¢ƒè¦æ±‚
- Go 1.23+
- Make
- protoc ç¼–è¯‘å™¨

### ç¼–è¯‘æŒ‡å—

```bash
# æ„å»ºèŠ‚ç‚¹ç¨‹åº
go build -o horizonfs-node ./cmd/node/main.go

# æ„å»ºç®¡ç†å®¢æˆ·ç«¯
go build -o hfs-cli ./cmd/client/main.go
```

---

## é›†ç¾¤å¯åŠ¨ç¤ºä¾‹

```bash
# å¯åŠ¨ 3 èŠ‚ç‚¹é›†ç¾¤ï¼ˆå• Raft Group æ¨¡å¼ï¼‰

# èŠ‚ç‚¹ 1 (Leader)
./horizonfs-node -id 1 -cluster http://127.0.0.1:9021,http://127.0.0.1:9022,http://127.0.0.1:9023 -port 9121

# èŠ‚ç‚¹ 2 (Follower)
./horizonfs-node -id 2 -cluster ... -port 9122 -join  # æ–°ç»ˆç«¯æ‰§è¡Œ

# èŠ‚ç‚¹ 3 (Follower)
./horizonfs-node -id 3 -cluster ... -port 9123 -join  # æ–°ç»ˆç«¯æ‰§è¡Œ
```

---

## å®¢æˆ·ç«¯æ“ä½œç¤ºä¾‹

```bash
# ä¸Šä¼ æ–‡ä»¶åˆ°é›†ç¾¤
./hfs-cli -addr=localhost:9121 upload -local=./sample.txt -remote=remote_sample.txt

# ä»é›†ç¾¤ä¸‹è½½æ–‡ä»¶
./hfs-cli -addr=localhost:9121 download -remote=remote_sample.txt -local=./downloaded.txt

# è·å–æ–‡ä»¶å…ƒæ•°æ®ï¼ˆä»»æ„èŠ‚ç‚¹å¯æŸ¥ï¼‰
./hfs-cli -addr=localhost:9122 get-meta -remote=remote_sample.txt
```

---

## æ¶æ„è§„åˆ’

### å½“å‰
- âœ… å• Raft Group å…ƒæ•°æ®ä¸€è‡´æ€§
- âœ… æµå¼æ•°æ®ä¼ è¾“åŸºç¡€æ¡†æ¶
- âœ… é«˜å¯†åº¦å…ƒæ•°æ®å­˜å‚¨

### æ„¿æ™¯
- ğŸ›  å¤š Raft Group å…ƒæ•°æ®åˆ†ç‰‡
- ğŸ›  æ•°æ®å¤šå‰¯æœ¬æœºåˆ¶ (3x å†—ä½™)
- ğŸ›  åŸºäºä¸€è‡´æ€§å“ˆå¸Œçš„è¯·æ±‚è·¯ç”±

---

## æŠ€æœ¯çŸ©é˜µ

| é¢†åŸŸ       | æŠ€æœ¯é€‰å‹                      |
|------------|-------------------------------|
| å…±è¯†åè®®   | etcd/raft v3                  |
| å­˜å‚¨å¼•æ“   | BadgerDB v4     |
| é€šä¿¡åè®®   | gRPC with streaming           |
| åºåˆ—åŒ–     | Protocol Buffers v3           |
| æ€§èƒ½ä¼˜åŒ–   | Sonic JSON + SIMD åŠ é€Ÿ        |

---

## ğŸ“ é¡¹ç›®ç»“æ„æ€»è§ˆ

```text
HorizonFS/
â”œâ”€â”€ cmd/                         # å‘½ä»¤è¡Œå·¥å…·å…¥å£
â”‚   â”œâ”€â”€ client/                  # å®¢æˆ·ç«¯ä¸»ç¨‹åº
â”‚   â”‚   â””â”€â”€ main.go
â”‚   â””â”€â”€ node/                    # èŠ‚ç‚¹ä¸»ç¨‹åº
â”‚       â””â”€â”€ main.go
â”œâ”€â”€ configs/                     # é…ç½®æ–‡ä»¶ç›®å½•ï¼ˆé¢„ç•™ï¼‰
â”œâ”€â”€ go.mod                       # Go ä¾èµ–ç®¡ç†æ–‡ä»¶
â”œâ”€â”€ go.sum
â”œâ”€â”€ internal/                    # é¡¹ç›®æ ¸å¿ƒé€»è¾‘
â”‚   â”œâ”€â”€ client/                  # å®¢æˆ·ç«¯é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ remote/              # ä¸èŠ‚ç‚¹äº¤äº’é€»è¾‘
â”‚   â”‚   â””â”€â”€ store/               # æœ¬åœ°æ–‡ä»¶æ“ä½œå°è£…
â”‚   â””â”€â”€ node/                    # åˆ†å¸ƒå¼èŠ‚ç‚¹æ ¸å¿ƒæ¨¡å—
â”‚       â”œâ”€â”€ grpcserver/          # gRPC æœåŠ¡æ³¨å†Œä¸å¯åŠ¨
â”‚       â”œâ”€â”€ kvstore/             # Badger å°è£…ä¸æ–‡ä»¶å¤„ç†
â”‚       â”œâ”€â”€ metadata/            # å…ƒæ•°æ®ç»“æ„ä¸å­˜å‚¨
â”‚       â”œâ”€â”€ raft/                # Raft å…±è¯†å®ç°å°è£…
â”‚       â”œâ”€â”€ service/             # gRPC æ¥å£æœåŠ¡å®ç°
â”‚       â””â”€â”€ types/               # é€šç”¨ç»“æ„å®šä¹‰
â”œâ”€â”€ pkg/                         # å…¬å…±åº“
â”‚   â”œâ”€â”€ logger/                  # æ—¥å¿—ç»„ä»¶
â”‚   â””â”€â”€ proto/                   # Proto æ–‡ä»¶ä¸ç”Ÿæˆä»£ç 
â”œâ”€â”€ scripts/                     # æ„å»ºä¸æµ‹è¯•è„šæœ¬
â”‚   â”œâ”€â”€ client_test_build.sh
â”‚   â”œâ”€â”€ generate_datanode_proto.sh
â”‚   â”œâ”€â”€ generate_metadata_proto.sh
â”‚   â””â”€â”€ node_test_build.sh
â”œâ”€â”€ tools/                       # è°ƒè¯•ä¸å¼€å‘è¾…åŠ©å·¥å…·
â”‚   â”œâ”€â”€ grpc-debug-client/
â”‚   â”‚   â””â”€â”€ main.go
â”‚   â””â”€â”€ grpc-debug-node/
â”‚       â””â”€â”€ main.go
â””â”€â”€ README.md                    # é¡¹ç›®è¯´æ˜æ–‡æ¡£
```

## Inspiration

- [etcd-io/raftexample](https://github.com/etcd-io/etcd/blob/main/contrib/raftexample/README.md) â€” A minimal Raft usage example in Go from the etcd team
- [zenyanle/Gflow](https://github.com/zenyanle/Gflow) â€” A lightweight and efficient edge computing data interaction platform


